syntax = "proto3";

package dmx_controller;

import "proto/color.proto";
import "proto/duration.proto";
import "proto/effect.proto";
import "proto/output.proto";

// A scene is a part of a live show that composes tiles together to form
// the final output of the universe.
message Scene {

  // A tile is a part of a scene that can be enabled or disabled and
  // applies state to the universe.
  message Tile {
    message EffectChannel {
      Effect effect = 1;

      OutputTarget output_target = 2;
    }

    message OneShotDetails { Duration duration = 1; }

    message LoopDetails {
      Duration fade_in = 1;
      Duration fade_out = 2;
    }

    string name = 1;

    repeated EffectChannel channels = 18;

    oneof timing_details {
      OneShotDetails one_shot = 19;
      LoopDetails loop = 20;
    }

    oneof transition {
      uint64 start_fade_in_ms = 11;
      uint64 start_fade_out_ms = 12;
      float absolute_strength = 17;
    }

    reserved 2;  // universe_sequence_id
    reserved 3;  // active
    reserved 4;  // string shortcut = 4 [deprecated = true];
    reserved 5;  // uint32 duration_ms = 5;
    reserved 6;  // double duration_beat = 6;
    reserved 7;  // uint32 fade_in_ms = 7;
    reserved 8;  // uint32 fade_in_beat = 8;
    reserved 9;  // uint32 fade_out_ms = 9;
    reserved 10; // uint32 fade_out_beat = 10;
    reserved 13; // uint64 sequence_id = 13;
    reserved 14; // EffectGroupTile effect_group = 14;
    reserved 15; // bool one_shot = 15;
    reserved 16; // map<string, string> controller_channel = 16 [deprecated =
                 // true];
  }

  message TileMap {
    uint64 id = 6;

    Tile tile = 1;

    // The horizontal index of the tile, measured from left to right.
    int32 x = 2;
    // The vertical index of the tile, measured from top to bottom.
    int32 y = 3;

    int32 priority = 4;

    reserved 5; // string shortcut = 5 [deprecated = true];
  }

  string name = 1;
  repeated TileMap tileMap = 13;
  map<uint64, ColorPalette> color_palettes = 7;
  uint64 active_color_palette = 8;
  uint64 last_active_color_palette = 9;
  uint32 color_palette_transition_duration_ms = 5;
  uint64 color_palette_start_transition = 6;
  reserved 10;

  reserved 11; // repeated Tile components = 11 [deprecated = true];
  reserved 12; // repeated ComponentRow rows = 12 [deprecated = true];
  reserved 2; // repeated ColorPalette deprecated_color_palettes = 2 [deprecated
              // = true];
  reserved 3; // uint32 deprecated_active_color_palette = 3 [deprecated = true];
  reserved 4; // uint32 deprecated_last_active_color_palette = 4 [deprecated =
              // true];
}
